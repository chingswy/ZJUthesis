
\section{人体三维姿态估计问题的研究}
\subsection{问题描述}
三维人体姿态估计问题，即是说给定输入的人体图片或视频序列，从中得到人体的三维关节点的位置。从上一节中我们已经得到了人体的二维关节点位置，因此对于这一部分我们需要得到相应的人体三维姿态的估计。但是在只有单个视角的情况下，三维估计具有尺度和深度的不确定性。在只有一个相机的情况下，通常使用各种先验信息来减少这种不确定性，在我们的实验场景下，我们可以利用多个相机的空间信息，来优化求解人体的三维关节点的坐标。

\subsection{模型概述}
\subsubsection{相机模型}
\comment{先写一下相机模型的定义}

\comment{这里写相机标定的内容}
\subsubsection{三角法}
% https://scm_mos.gitlab.io/2018/12/08/triangulate/
对于三维空间中的一点$\bfX$，其在世界坐标系中的表示为
\begin{equation}
    \bfX = [x,y,z,1]^T
\end{equation}
第$i$个相机的参数矩阵为
\begin{equation}
    P_i = K_i[R_i | t_i] = \left[ \begin{array}{c}
        P_{i1} \\ P_{i2} \\ P_{i3}
    \end{array}\right]  
\end{equation}
点$X$在第$i$个相机中的投影的坐标为
\begin{equation}
    \bm{x_i} = (x_i, y_i, 1)^T    
\end{equation}
根据投影方程，即有
\begin{equation}
    \bm{x_i} = P_i\bfX
\end{equation}
上式两边同时叉乘$\bm{x_i}$，即有
\begin{equation}
    \bm{x_i} \times (P_i\bfX) = 0
\end{equation}
展开即可得到：
\begin{align}
    x_i(P_{i3}\bm{X}) &- P_{i1}\bm{X} = 0 \\
    y_i(P_{i3}\bm{X}) &- P_{i2}\bm{X}= 0 \\
    x_i(P_{i2}\bm{X}) &- y_iP_{i1}\bm{X}= 0
\end{align}
第三个方程与前两个方程线性相关，因此该组方程实际只提供了两个自由度，即
\begin{align}
    \left[ \begin{array}{c}
        x_iP_{i3} - P_{i1} \\ y_iP_{i3} - P_{i2}
    \end{array}\right]\bm{X} = \bm{0}
\end{align}
因此每个相机上的一个观察点提供了两个约束，而该点的坐标有三个自由度，因此至少需要两个视角才能解出一个点的坐标。而我们的能用的视角个数大于两个，也就是说需要求解超定方程。即求解超静定的齐次线性方程
\begin{equation}
    AX = \bm{0}
\end{equation}
因此我们采用SVD分解的方法，计算$A$矩阵奇异值最小的对应的奇异向量，就是三维坐标的解。那么我们的问题即为假定未知的所有的关节的三维点的坐标为$S\in \mathbb{R}^{3\times N}$，$N$为关节点的数目，第$i$ 个相机的参数为$R_i,T_i,K_i$。那么该问题的方程可写为：
\begin{equation}
    \left[ \begin{array}{cccc}
        x_{00}P_{03} - P_{01}  & x_{10}P_{03} - P_{01} & \cdots & x_{n0}P_{03} - P_{01} \\ 
        y_{00}P_{03} - P_{02}  & y_{10}P_{03} - P_{02} & \cdots & y_{n0}P_{03} - P_{02} \\
        x_{01}P_{13} - P_{11}  & x_{11}P_{13} - P_{11} & \cdots & x_{n1}P_{13} - P_{11} \\ 
        y_{01}P_{13} - P_{12}  & y_{11}P_{13} - P_{12} & \cdots & y_{n1}P_{13} - P_{12} \\
        \vdots & \vdots & \ddots & \vdots \\
        x_{0i}P_{i3} - P_{i1}  & x_{1i}P_{i3} - P_{i1} & \cdots & x_{ni}P_{i3} - P_{i1} \\ 
        y_{0i}P_{i3} - P_{i2}  & y_{1i}P_{i3} - P_{i2} & \cdots & y_{ni}P_{i3} - P_{i2}
    \end{array}\right] \left[ \begin{array}{cccc}
        X_0 & X_1 & \cdots & X_n \\
        Y_0 & Y_1 & \cdots & Y_n \\
        Z_0 & Z_1 & \cdots & Z_n \\
        1 & 1 & \cdots & 1
    \end{array}\right]  = \bm{0}
\end{equation}


\subsubsection{优化法}
相机投影模型为
\begin{equation}
    Z_i W_i = K_i(R_iS + T_i)
\end{equation}
\begin{equation}
W_i = Z_i^{-1}K_i(R_iS + T_i)    
\end{equation}
其中$W_i\in \mathbb{R}^{3\times p}$  表示第$i$ 个相机下的二维齐次坐标，那么根据各个视角下的观测到的二维坐标，我们的目标函数可以写为
\begin{equation}
    \min \sum^I_{i=1} \sum_{p=1}^P \omega_{ip}||W_{ip} - \hat W_{ip}||_2
\end{equation}
\begin{equation}
    \min \sum^I_{i=1} \sum_{p=1}^P \omega_{ip}||Z_i^{-1}K_i(R_iS_p + T_i) - \hat W_{ip}||_2  
\end{equation}

\subsection{模型应用}
\comment{写在LightStage数据上采集得到的结果}
