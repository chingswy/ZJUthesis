\section{轮廓与纹理重建}

在上一章的内容中，我们完成了使用一个参数驱动的模型拟合到重建出的三维关键点上。使用这种模型表示能够得到一个各个关节具有六自由度的人体模型，但是其仍存在许多不足。例如，这中参数化的人体模型表示的是一个泛化的人体模型，而没有针对单个人的细致的纹理。由于我们的整个方法都是基于RGB图片的，因此对人体的外观没有限制，因此我们可以在同样的实验环境下同时得到人的轮廓信息，再使用人体的轮廓信息对我们得到的人体网格模型进行优化。这一部分内容中，我们首先介绍一下从图片中获得人体轮廓的方法，接着将其运用到我们所录制的视频数据上，获得人体的轮廓信息，接着根据人体的轮廓信息进行对前一步得到的网格进行变形，最后得到人体的带纹理的模型的结果。

\subsection{自动分割}
从图像中获得人体的轮廓也是计算机视觉中的一个重要的研究方向，这个问题指的是从一张包含了一个或者多个人体的图片中，去判断一个像素是属于人体的像素还是不属于人体的像素；在这基础上还拓展出了实例分割任务，即是说判断一个像素是否属于人体身上的像素的同时，还需要将不同人的像素区别开，能够识别出图像中不同的人体；另一方面，对于单个人体，在判断一个像素是否属于该人的基础上，还可以判断这个像素属于人体的哪一个部位，这种任务一般叫做语义分割任务。这个任务在对图片或视频中的人体进行分析中是十分基础的，同时也是非常关键的。随着深度学习的发展，尤其是全卷积网络(FCN)的出现，人体的语义分割任务取得了较大的进步。

Gong等人\cite{cihppgn}提出了一种不需要检测的部件分组网络(Detection-free Part Grouping Network，以下简称PGN)。这个网络主要分为两个部分，第一个部分是进行语义分割，即能够区别人体的不通部位，第二个部分是进行边缘检测，主要的目的是将人体的边缘提取出来。在这两个部分的后面，需要将两个部分进行融合，将分割的结果进行优化，最后再对每个部分的人体的标记进行提取。

\subsubsection{网络结构}

由于我们在进行重建时，目前只考虑人体的整体的轮廓，因此我们对语义分割的结果进行二值化处理，得到属于人体的轮廓信息，如图\ref{fig:mask}所示，从图中可以看出，我们的轮廓提取的模型能够在该场景下得到较为准确的分割结果。

\subsection{轮廓重建}
根据前面得到的每个视角下的人体轮廓信息，以及之前的标定的相机参数，传统的对人体进行重建的方法是使用可视外壳(Visual Hull)的方法，该方法的思路是在空间中维护一个\(N\times N\times N\)的三维网格结构信息，将各个试图的轮廓反投影到该三维网格之中，再通过Marching Cube的算法来获得人体的三维结构。该方法的缺点是，在进行恢复的时候体素占据了大量的计算机存储空间，同时该方法的进度是由体素的分辨率决定的，而通常该分辨率都无法设置到很大，因此该方法的分辨率也较低。并且使用该方法的时候没有预先知道想要恢复的结构的大小，因此使用体素来进行融合会带来许多误差，使得体素的网格无法很好地融合各个视角的信息。

而在我们这个问题中，由于我们已经预先使用了一个参数化人体几何模型来对人体进行了表示，相当于我们的人体模型以及获得了一个较为粗略的表示。我们就可以利用这种先验的几何信息来对问题进行约束，而不是像使用可视外壳的方法没有任何先验信息地进行重建。同样，在考虑人体几何模型的条件下，依然有两种方法可以选择：一种是将各个视角的轮廓信息反投影到三维世界坐标中；另一种是将人体的几何模型投影到各个相机平面上。在将各个视角的轮廓信息反投影到三维世界坐标时，我们需要考虑如何对这些三维结构信息进行表示。常用的做法是使用体素的方法，即将一定范围内的有限大小的空间划分成一个\(N\times N \times N\)的网格结构。但是这样的做法将会降低模型的进度，因为进行了离散化处理，那么可能精细的轮廓信息就无法充分利用。因此我们采用了另一种途径，即将几何模型投影到各个视角的相机上，得到一个当前的各个视角的几何模型的轮廓信息，将这个轮廓信息与我们直接从图片中得到的轮廓信息进行对比，使用他们之间的差异作为损失函数，来行成一个新的优化问题，通过对这个优化问题进行求解，即可将我们的几何模型优化到一个更加贴合我们的模型的状态。

问题的关键在于，一般难以直接使用投影到图像上的轮廓作为损失函数，因为将几何模型投影到图像上转化到相机坐标系的过程会有离散化的操作，而标准的离散化的操作过程在大部分地方的导数都为0。这就导致了如果一个损失函数中包含了离散化的操作，那么整个函数的导数将几乎处处为0，这也就使得优化过程无法进行。因此最近几年的一些工作中，有许多人研究如何将离散化这一过程变得更加连续。在Kato\cite{neuralrender}等人的2017年的工作中，他们将离散化的过程进行了修改。例如对于图\ref{fig:nmr}(a)中的一个三角形面片，将其投影到像素平面上时，对于一个点来说，以输出的是轮廓为例。通常在输出轮廓时，用1来表示该像素属于人体，用0来表示该像素属于背景部分。那么标准的离散化的过程如图\ref{fig:nmr}(b)所示，如果该像素位于三角形的内部，那么其像素值即为1，如果该像素不位于该三角形的内部，那么其像素值就为0。对于这样的标准的离散化过程，其导数会处处为0，如图\ref{fig:nmr}(c)所示。虽然这个函数在边缘处的导数为无穷大，但是由于像素值是不连续的，因此通常边缘处的导数都无法取到，因此像素值关于像素位置的导数就全部是0了，导致没有梯度可以反向传递回去，因此无法直接使用该方法进行梯度下降优化。因此Kato\cite{neuralrender}等人对\ref{fig:nmr}(b)中的函数进行了修改，这样修改使得在边缘处不是直接从0突变到1，而是有一定斜率的变化。这样的离散化方法如果输出图片的话，就相当于在边缘处进行了模糊。这样设计的好处就是，该函数的梯度不再是处处为0了，而是会分段的有值，如\ref{fig:nmr}(e)所示。 
\begin{figure}[htbp]
    \centering
    \includegraphics[width=0.5\linewidth]{figure/mask/neuralrender}
    \caption{\label{fig:nrm} 渲染离散化过程示意}
\end{figure}

我们对我们前一步估计得到的人体几何模型进行投影，得到其在每个相机上的轮廓视图，同时又使用了PGN的方法直接从图片中提取得到轮廓，我们将两个轮廓叠在一起进行对比，如图\ref{fig:maskcom}所示。图中蓝色部分表示两个轮廓的重合部分，红色部分表示实际轮廓中多出的部分，青色部分表示人体几何模型多出的部分。从图\ref{fig:maskcom}中可以看出，我们之前重建的结果较为可靠，直接使用人体几何模型来表示就可以在大部分区域与实际中的人体轮廓。为了对该过程进行量化，我们使用重叠度(Intersection Over Union，简称IoU)这一指标来进行衡量。重叠度通常用来进行评价目标检测任务，其定义是两块区域的交集与两块区域的并集的比例，在我们的问题中，我们使用一个二值化的矩阵\(S\)来表示轮廓，即
\begin{equation}
    S_{ij} = \begin{cases}
        1, & \text{\((i,j)\)处像素属于人体区域} \\
        0, & \text{\((i,j)\)处像素不属于人体区域}
    \end{cases}
\end{equation}
对于两个轮廓，其重叠度计算公式则为
\begin{equation}
    IoU = \frac{S_a \cap S_b}{S_a \cup S_b} = \frac{S_a \cdot S_b}{S_a + S_b - \cdot S_a\cdot S_b}
\end{equation}

为了使我们的模型更加贴合实际的人体轮廓，如果只使用参数化模型会无法拟合到各个轮廓上，因此我们对之前的人体三维网格模型进行修改，对于模型上的每一个顶点，我们都给其加上一个小的偏移量\(d_i\)，通过这个偏移量去控制人体模型，使其更加接近实际轮廓。同样我们通过定义损失函数，然后再去最小化这个损失函数的方法，损失函数也由不同的项组成。首先是模型拟合项
\begin{equation}
    L_{silh} = || S_{real} - \Pi(V(\theta, \beta, D)) ||_2
\end{equation}


\begin{figure}[htbp]
    \centering
    \includegraphics[width=0.5\linewidth]{figure/result/mask/shuai}
    \caption{\label{fig:maskcom} 重建的轮廓与图片中获得的轮廓对比}
\end{figure}

\subsection{动作迁移}
在影视制作业中，通常会有这样的需求，即通过专业的动作演员生成一段特殊的动作，例如高难度的武打动作，然后将这段动作序列迁移到另一个演员模型上，或者迁移到一个动画模型上。在我们的算法中，由于使用了人体的几何模型，因此我们同样也可以完成这样的事情。其主要流程为：通过我们的动作捕捉系统获得演员的动作序列；通过其他方式获得演员的模型贴图，或者同样通过我们的系统获得演员的模型贴图；将动作序列与模型贴图进行组合，即可得到另一个演员的完成这个动作的图片或者视频了。

例如针对我们获取的演员帅的动作数据，我们将重建获得的人体几何模型的姿态参数和形状参数以及在世界坐标系中的位置的数据保存下来。我们将其进行纹理贴图，纹理文件来源于 等人的论文所提供的纹理贴图\cite{surreal}。为了体现模型的通用性，我们

\unsure{}{这里写如何把别人的纹理贴过来}

\unsure{}{这里写如何贴纹理}